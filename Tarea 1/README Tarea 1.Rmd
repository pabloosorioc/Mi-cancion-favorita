## PROYECTO: Mi canci√≥n favorita

#Contexto

En el ramo de Medici√≥n y An√°lisis Dimensional de Datos Pol√≠ticos nos dieron como tarea mostrar b√°sicamente que aprendimos. Como era tem√°tica libre, se me ocurri√≥ determinar **cu√°l es mi canci√≥n favorita**.

# Tarea 1

Para esta tarea 1, voy a comenzar observando las caracter√≠sticas de mis canciones favoritas. Para mayor contexto, tengo una **playlist de canciones que yo considero como mis favoritas**, pero no la tengo ordenada bajo ning√∫n par√°metro. La idea es que de aqu√≠ a que terminen las tareas poder ordenarlas.

Primero, cargamos las librer√≠as:

```{r}
library(tidyverse)
library(ggplot2)
library(spotifyr)
library(dplyr)
library(purrr)
library(stringr)
library(tidyr)
```

Para obtener la informaci√≥n de las canciones se usa la API de Spotify. Para eso hay que crearse una cuenta como desarrollador y obtener las credenciales (Client ID y Client Secret). Con estas, se puede configurar R:

```{r}
Sys.setenv(SPOTIFY_CLIENT_ID = 'XXXX')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'XXXX')
# Se pone el token de acceso:
access_token <- get_spotify_access_token()
```

Con todo esdto, se pone el ID de la playlist. En mi caso dejar√© el link de mi playlist donde se puede obtener el ID: <https://open.spotify.com/playlist/74K2s9BYNZgJiaKUwJciCL?si=e9990c03d7ba47b0>

Con esto, se debe poner el ID de la playlist como objeto:

```{r}
playlist_id <- "74K2s9BYNZgJiaKUwJciCL"
```

Para obtener las canciones, use la funci√≥n de spotifyr, pero esta solo permit√≠a obtener las 100 primeras. Como mi playlist eran m√°s de 200 canciones tuve que hacer un bucle. Finalmente qued√© con 2 bases y las junt√© de la siguiente forma:

```{r}
canciones2 <- get_playlist_tracks(playlist_id) #100 primeras

offset <- 0
limit <- 100

canciones <- data.frame()

repeat {
  batch <- get_playlist_tracks(playlist_id, limit = limit, offset = offset)
  if (nrow(batch) == 0) break
  canciones <- bind_rows(canciones, batch)
  offset <- offset + limit
}# el resto

# Unirlas
canciones_final <- bind_rows(canciones2, canciones)

save(canciones_final, file = "data/canciones_playlist.RData") #Guardar para el futuro
```

En el caso de no tener acceso a Spotify Developer, s√≥lo carga la base de datos:

```{r}
load("../data/canciones_playlist.RData")
```

Ahora, quer√≠a saber primero que artista era el que m√°s se repet√≠a en la playlist para comenzar a tener un indicio de mi canci√≥n favorita. Para eso hice una base con el artista y la cantidad de veces que se repet√≠a (contando colaboraciones):

```{r}
lista_artistas <- map(canciones_final$track.artists, ~ .x$name)

vector_artistas <- unlist(lista_artistas)

conteo_artistas <- data.frame(artista = vector_artistas) |> 
  group_by(artista) |> 
  summarise(canciones = n()) |> 
  arrange(desc(canciones))

# Guardamos ese archivo

write_csv(conteo_artistas, "data/conteo_artistas.csv")
```

Y finalmente graficamos el top 20 de artistas que m√°s se repiten:

```{r}
ggplot(conteo_artistas[1:20, ], 
       aes(x = reorder(artista, canciones), y = canciones)) +
  geom_col(fill = "#800020") +  # color burdeo üç∑
  geom_text(aes(label = canciones), hjust = -0.2, size = 4, family = "Georgia") + # etiquetas de cantidad
  coord_flip() +
  labs(
    title = "üé∂ Artistas m√°s repetidos en la playlist",
    x = "Artista",
    y = "N√∫mero de canciones (incluye colaboraciones)"
  ) +
  theme_minimal(base_size = 14, base_family = "Georgia") +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 16),
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.text.y = element_text(size = 12),
    axis.title = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank(),
    plot.background = element_rect(fill = "grey", color = NA)
  )
```

```{r}
ggsave("output/artistas_mas_repetidos_playlist.png", width = 9, height = 6)
```

Con esto, podemos ver en el gr√°fico que el artista que m√°s se repite es A Day To Remember, lo cual tiene mucho sentido puesto que es mi banda favorita desde los 12 a√±os. Lo sigue Noah Kahan y Kendrick Lamar, lo que es sorprendente considerando que el primero es un artista relativamente nuevo y Kendrick lo sigo desde el 2016 aproximadamente. Finalmente est√°n Ariana y Taylor que son de mi √©poca pop lolita.
